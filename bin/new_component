#!/bin/bash

# Use relative directory
cd "${BASH_SOURCE%/*}"

NAME=$1
IDX_FILE=../src/index.js
SRC_FILE=../src/$NAME/$NAME.jsx
LESS_FILE=../src/$NAME/$NAME.less
LESS_COMPONENTS_FILE=../src/less/components.less
TEST_FILE=../test/${NAME}_test.jsx

# Error if directory cannot be created
mkdir ../src/$NAME 2>/dev/null
if [[ $? -ne 0 ]] ; then
  echo "Error: '$NAME' already exists!"
  exit 1
fi

# Add component to index.js and create stub files
echo "export {$NAME} from \"./$NAME/$NAME\";" >> $IDX_FILE
sed "s/COMPONENT_NAME/$NAME/" ./example_component.jsx.txt > $SRC_FILE
sed "s/COMPONENT_NAME/$NAME/" ./example_stylesheet.less.txt > $LESS_FILE
sed "s/COMPONENT_NAME/$NAME/" ./example_test.jsx.txt > $TEST_FILE

# Add components styles to components.less
echo "@import \"../$NAME/$NAME\";" >> $LESS_COMPONENTS_FILE

GREEN='\033[0;32m'
DEFAULT='\033[0m'

echo "Successfully created component '$NAME'"
echo -e "Component: $GREEN'src/$NAME/$NAME.jsx'$DEFAULT"
echo -e "Less file: $GREEN'src/$NAME/$NAME.less'$DEFAULT"
echo -e "Unit test: $GREEN'test/${NAME}_test.jsx'$DEFAULT"
